{% include "/public/header.html" %}
<h1>{{res.h1}}</h1>
<hr class="layui-border-blue">
<div class="layui-tab layui-tab-card" lay-filter="test-hash">
    <ul class="layui-tab-title">
        <li class="layui-this" lay-id="添加任务">① 添加任务</li>
    </ul>
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            <form class="layui-form">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">目标</label>
                        <div class="layui-input-inline" style="width: 500px;">
                            <textarea name="targets" id="targets" placeholder="" rows="10"
                                class="layui-textarea">{{res.target_document}}</textarea>
                            <div class="layui-form-mid layui-word-aux">
                                为空则使用上次目标<br>
                                目标IP或url放这,将被写入 <a target="_blank"
                                    href="/static/output/{{res.tool_name}}/{{res.targets_name}}">target(点击查看)</a> 中
                            </div>
                        </div>

                        <label class="layui-form-label">剩余结果</label>
                        <div class="layui-input-inline" style="width: 600px;">
                            <textarea name="other_content" id="other_content" placeholder="" rows="10"
                                class="layui-textarea">{{res.other_content}}</textarea>
                            <div class="layui-form-mid layui-word-aux">
                                <!-- 帮助文档写这儿， -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        {% if res['form_create'] != null %}
                        <button class="layui-btn  layui-btn-primary layui-border layui-border-green  " lay-submit
                            lay-filter="form_create">
                            生成</button>
                        {% endif %}
                        <!-- 打开结果路径 -->
                        {% if res['result_path'] != null %}
                        <input type="text" name="result_path" autocomplete="off" class="layui-input"
                            style="display:none" value="{{ res['result_path']}}">
                        <button
                            class="layui-btn  layui-btn-primary layui-border layui-border-green   layui-btn-primary "
                            lay-submit lay-filter="form_open_result_path">
                            打开结果路径</button>
                        {% endif %}
                    </div>
                </div>
                <script>
                    layui.use(function () {
                        var form = layui.form;
                        var $ = layui.$;
                        var layer = layui.layer;

                        //提交_new
                        form.on('submit(form_create)', function (data) {
                            $.ajax({
                                type: "POST",
                                url: "/{{res['tool_name']}}/update",
                                data: JSON.stringify(data.field),
                                dataType: "json",
                                success: function (res) {
                                    console.log(res)
                                    // shell = res.data.replace(";", ";\n")
                                    $("#shell").val(res.data);
                                    // layer.msg(res.msg);
                                    location.reload();
                                }
                            })
                            return false;
                        });
                        // 打开结果路径
                        form.on('submit(form_open_result_path)', function (data) {
                            $.ajax({
                                type: "POST",
                                url: "/exec/update",
                                data: JSON.stringify({ "shell": "explorer " + data.field['result_path'] + ";exit" }),
                                // data: { "shell": data.field['shell'] },
                                dataType: "json",
                                success: function (res) {
                                    console.log(res);
                                    layer.msg(res.msg);
                                }
                            })
                            return false;
                        });
                    });
                </script>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <div class="layui-inline">
                            <label class="layui-form-label">分析结果</label>
                            <div class="layui-input-inline" style="width: 400px;">
                                <textarea name="ssh_content" id="ssh_content" placeholder="" rows="10"
                                    class="layui-textarea">{{res.ssh_content}}</textarea>
                                <div class="layui-form-mid layui-word-aux">
                                    <a target="_blank"
                                    href="/static/output/{{res.tool_name}}/ssh.txt">ssh结果-点击查看</a>
                                    <button type="button"
                                        class="layui-btn layui-btn-primary layui-border layui-border-green  layui-btn-primary layui-btn-sm"
                                        lay-submit lay-filter="server_login" id="ssh">
                                        点击验证
                                    </button>
                                </div>
                            </div>
                            <div class="layui-input-inline" style="width: 400px;">
                                <textarea name="sql_content" id="sql_content" placeholder="" rows="10"
                                    class="layui-textarea">{{res.sql_content}}</textarea>
                                <div class="layui-form-mid layui-word-aux">
                                    <a target="_blank"
                                    href="/static/output/{{res.tool_name}}/sql.txt">sql结果-点击查看</a>
                                    <button type="button"
                                        class="layui-btn layui-btn-primary layui-border layui-border-green  layui-btn-primary layui-btn-sm layui-btn-disabled" 
                                        lay-submit lay-filter="server_login" id="sql">
                                        点击验证
                                    </button>
                                </div>
                            </div>
                            <div class="layui-input-inline" style="width: 400px;">
                                <textarea name="web_content" id="web_content" placeholder="" rows="10"
                                    class="layui-textarea">{{res.web_content}}</textarea>
                                <div class="layui-form-mid layui-word-aux">
                                    <a target="_blank"
                                    href="/static/output/{{res.tool_name}}/web.txt">web结果-点击查看</a>
                                    <button type="button"
                                        class="layui-btn layui-btn-primary layui-border layui-border-green  layui-btn-primary layui-btn-sm layui-btn-disabled"
                                        lay-submit lay-filter="" id="">
                                        点击验证
                                    </button>
                                </div>
                            </div>
                            <div class="layui-input-inline" style="width: 400px;">
                                <textarea name="ftp_content" id="ftp_content" placeholder="" rows="10"
                                    class="layui-textarea">{{res.ftp_content}}</textarea>
                                <div class="layui-form-mid layui-word-aux">
                                    <a target="_blank"
                                    href="/static/output/{{res.tool_name}}/ftp.txt">ftp结果-点击查看</a> <button type="button"
                                        class="layui-btn layui-btn-primary layui-border layui-border-green  layui-btn-primary layui-btn-sm layui-btn-disabled"
                                        lay-submit lay-filter="" id="">
                                        点击验证
                                    </button>
                                </div>
                            </div>
                            <div class="layui-input-inline" style="width: 400px;">
                                <textarea name="infoscan_content" id="infoscan_content" placeholder="" rows="10"
                                    class="layui-textarea">{{res.infoscan_content}}</textarea>
                                <div class="layui-form-mid layui-word-aux">
                                    <a target="_blank"
                                    href="/static/output/{{res.tool_name}}/infoscan.txt">infoscan结果-点击查看</a> <button type="button"
                                        class="layui-btn layui-btn-primary layui-border layui-border-green  layui-btn-primary layui-btn-sm layui-btn-disabled"
                                        lay-submit lay-filter="" id="">
                                        点击验证
                                    </button>
                                </div>
                            </div>
                        </div>

                        <script>
                            layui.use(function () {
                                var layer = layui.layer;
                                var $ = layui.$;
                                var form = layui.form;
                                form.on('submit(server_login)', function (data) {
                                    var button_id = $(this).attr('id')
                                    var targets = ""
                                    if (button_id === 'ssh') {
                                        targets = data.field.ssh_content;
                                    } else if (button_id === 'sql') {
                                        targets = data.field.sql_content;
                                    }
                                    var form = $('<form action="/server_login/" method="POST">' +
                                        '<input type="hidden" name="plugins" value="' + button_id + '">' +
                                        '<input type="hidden" name="targets" value="' + targets + '">' +
                                        '</form>');
                                    $('body').append(form);
                                    form.submit();
                                });
                            });
                        </script>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% include "/public/footer.html" %}